# Telegram Support Bot

**Телеграм-бот технической поддержки** — прокси между партнёрами и менеджерами техподдержки через Telegram.

---

## Описание

Данный бот служит единственной точкой входа в Telegram-чаты с партнёрами и обеспечивает централизованную коммуникацию:

- Все сообщения от партнёров перехватываются ботом и пересылаются в внутренний чат поддержки (канал, где находятся менеджеры).
- Менеджеры отвечают через этот внутренний чат — бот пересылает ответы обратно партнёрам от своего имени.
- Поддерживается два режима ответа менеджера:
  - Ответ в треде (reply_to_message)
  - Ответ отдельным сообщением
- Хранение и сопоставление ID сообщений для корректной маршрутизации.

---

## Структура проекта

- main.py — Запуск бота
- Dockerfile — Файл для контейнеризации
- docker-compose.yml — Конфигурация для запуска с PostgreSQL
- config.py — Конфигурация из .env
- logs.py — Логирование
- database/ — Работа с базой данных (SQLAlchemy async)
  - base.py — Инициализация БД
  - models.py — Модель БД
  - crud.py — CRUD для работы записи в БД
- handlers/ — Обработчики событий Telegram
  - user.py — Обработчик сообщений от пользователей
  - manager.py — Обработчик ответов менеджеров
  - callbacks.py — Обработчик нажатий на кнопки
- services/utils.py — Вспомогательные функции

---

## Установка и запуск

1. Скопируйте проект и перейдите в каталог:

```bash
git clone https://github.com/twentyonetima/tg_support_bot.git
cd telegram_support_bot
```

2. Создайте виртуальное окружение:

```bash
python -m venv venv
source venv/bin/activate
pip install -r rq.txt
```

3. Постройте и запустите контейнеры через Docker Compose:

```bash
docker-compose up --build
```

После старта бот автоматически создаст нужные таблицы в базе данных и начнет принимать сообщения.

4. Создайте новый support чат с ботом, в котором находят менеджеры и замените CHAT_ID в .env или вступите в уже созданный чат для менеджеров:
```bash
https://t.me/+g6Qz_HjjO2tlMmRi 
```
---

## Использование

1. Партнёры пишут в свои Telegram-чаты, где присутствует бот.
2. Все сообщения автоматически пересылаются в чат поддержки.
3. В чате поддержки менеджеры видят сообщение с кнопками для выбора режима ответа: в треде или отдельным сообщением.
4. Менеджер выбирает режим, затем отвечает на сообщение.
5. Ответ автоматически пересылается боту и отправляется партнёру с выбранным режимом.

---

## Дополнительно

- Реализовано хранение полной истории переписки с использованием PostgreSQL.
- Реализована поддержка английского и русского языков для пользователя.
